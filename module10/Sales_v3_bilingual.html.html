<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ежедневный отчёт — Отдел продаж</title>

<style>
.kpi-container {
  max-width: 520px;
  margin: 0 auto;
  padding: 20px;
  border-radius: 12px;
  background: #f4f7fb;
  font-family: Arial, sans-serif;
  border: 1px solid #dde4f0;
}
.kpi-container h2 {
  font-size: 20px;
  margin-bottom: 15px;
  color: #12345b;
}
.kpi-container label {
  font-size: 14px;
  font-weight: 600;
  margin-top: 8px;
  display: block;
}
.kpi-container input,
.kpi-container textarea {
  width: 100%;
  padding: 8px 10px;
  margin: 4px 0 10px;
  border-radius: 6px;
  border: 1px solid #cdd4e0;
  box-sizing: border-box;
}
.kpi-container button {
  margin-top: 10px;
  background: #0057b7;
  color: #fff;
  padding: 10px;
  border: none;
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
}
.kpi-container button:hover {
  opacity: 0.9;
}
.success {
  color: green;
  font-weight: bold;
}
.error {
  color: red;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="kpi-container">
  <h2>Ежедневный отчёт + KPI — ОТДЕЛ ПРОДАЖ (Compressor.az)</h2>

  <form id="salesReportForm">
    <label>Дата:</label>
    <input type="date" name="date" required>

    <label>Сотрудник:</label>
    <input type="text" name="employee" placeholder="ФИО" required>

    <input type="hidden" name="department" value="Sales">

    <label>Звонки (шт):</label>
    <input type="number" name="calls" min="0" value="0">

    <label>Встречи (шт):</label>
    <input type="number" name="meetings" min="0" value="0">

    <label>Отправленные КП (шт):</label>
    <input type="number" name="offers" min="0" value="0">

    <label>Закрытые сделки (шт):</label>
    <input type="number" name="deals" min="0" value="0">

    <label>Новые клиенты (шт):</label>
    <input type="number" name="new_clients" min="0" value="0">

    <hr>

    <label>Выручка всего (AZN):</label>
    <input type="number" name="revenue_total" min="0" value="0">

    <label>Выручка от оборудования (AZN):</label>
    <input type="number" name="revenue_equipment" min="0" value="0">

    <label>Выручка от ЗИП (AZN):</label>
    <input type="number" name="revenue_zip" min="0" value="0">

    <label>Выручка от сервиса (AZN):</label>
    <input type="number" name="revenue_service" min="0" value="0">

    <label>Комментарий:</label>
    <textarea name="comment" rows="3" placeholder="Кратко по дню: важные клиенты, сделки, договорённости"></textarea>

    <button type="submit">Сохранить отчёт</button>
  </form>

  <p id="salesStatus" style="margin-top:10px;"></p>
</div>

<script>
document.getElementById('salesReportForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const formData = new FormData(this);
  const data = Object.fromEntries(formData.entries());

  // Числовые поля
  [
    "calls","meetings","offers","deals","new_clients",
    "revenue_total","revenue_equipment","revenue_zip","revenue_service"
  ].forEach(key => {
    data[key] = Number(data[key] || 0);
  });

  const statusEl = document.getElementById("salesStatus");

  try {
    await fetch("https://script.google.com/macros/s/AKfycbxbZCdOuATN4kbiHMbgmHjWlfnWGyPf_Cb0zJFbSjNq-jMMqP_uyc4v1e7xa3PMeFqg9w/exec", {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(data)
    });

    statusEl.innerHTML = "✔ Отчёт сохранён!";
    statusEl.className = "success";
    this.reset();

  } catch (err) {
    statusEl.innerHTML = "❌ Ошибка при сохранении!";
    statusEl.className = "error";
  }
});
</script>

</body>
</html>
