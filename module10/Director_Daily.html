<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Director Daily Report</title>
  <style>
    body { background:#F4F7FB;font-family:Arial,sans-serif;margin:0;padding:0; }
    .wrap { max-width:640px;margin:30px auto;padding:25px;background:#fff;border-radius:16px;border-left:6px solid #0057B7;box-shadow:0 4px 16px rgba(0,0,0,.08);}
    .lang{ text-align:right;margin-bottom:10px;}
    .lang button{ background:#0057B7;color:#fff;border:none;padding:6px 12px;margin-left:5px;border-radius:6px;cursor:pointer;font-size:13px;}
    .lang button.active{ background:#003F8A;}
    h2{ color:#12345B;margin-bottom:15px;}
    label{ font-weight:600;font-size:14px;margin-top:10px;display:block;}
    input,select,textarea{ width:100%;padding:8px 10px;margin-top:4px;margin-bottom:10px;border-radius:8px;border:1px solid #C9D4E0;box-sizing:border-box;}
    textarea{ min-height:80px;}
    button.save{ margin-top:15px;width:100%;padding:12px;background:#0057B7;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;}
    button.save:hover{ background:#003F8A;}
    #status.success{ color:green;font-weight:bold;}
    #status.error{ color:red;font-weight:bold;}
    .deny{display:flex;align-items:center;justify-content:center;height:100vh;background:#fff;}
    .deny .box{max-width:420px;border-left:6px solid #c00000;padding:24px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.12);}
    .deny h2{color:#c00000;margin:0 0 10px;}
  </style>
</head>

<body>

<!-- ✅ ЗАЩИТА: доступ только из твоего Bitrix24 -->
<script>
(function(){
  const allowedHosts = [
    "bitrix24.com",
    "bitrix24.ru",
    "anzenergyllc.bitrix24.ru"   // ✅ ТВОЙ ПОРТАЛ
  ];
  const ref = document.referrer || "";
  const ok = allowedHosts.some(h => ref.includes(h));
  if(!ok){
    document.body.innerHTML = `
      <div class="deny">
        <div class="box">
          <h2>Доступ запрещён</h2>
          <p>Откройте форму из Bitrix24 портала.</p>
        </div>
      </div>`;
  }
})();
</script>

<div class="wrap">
  <div class="lang">
    <button id="btnAZ" class="active">AZ</button>
    <button id="btnRU">RU</button>
  </div>

  <h2 id="formTitle">Direktor — gündəlik hesabat</h2>

  <form id="directorForm">
    <input type="hidden" name="department" value="Director_Daily">
    <input type="hidden" id="lang" name="language" value="AZ">

    <label id="lblDate">Tarix:</label>
    <input type="date" name="date" required>

    <label id="lblName">Ad:</label>
    <input type="text" name="employee" required>

    <label id="lblReportAnalysis">İşçi hesabatlarının analizi:</label>
    <select name="report_analysis">
      <option value="Bəli / Да">Bəli / Да</option>
      <option value="Xeyr / Нет">Xeyr / Нет</option>
    </select>

    <label id="lblCRMWork">CRM işi:</label>
    <textarea name="crm_work" placeholder="Сделки, статусы, комментарии..."></textarea>

    <label id="lblTasksStatus">Bitrix24 tapşırıqları:</label>
    <select name="tasks_status">
      <option value="Bağlandı / Закрыто">Bağlandı / Закрыто</option>
      <option value="Köçürüldü / Перенесено">Köçürüldü / Перенесено</option>
      <option value="Riskdə / В риске">Riskdə / В риске</option>
    </select>

    <label id="lblDiscipline">İntizam nəzarəti:</label>
    <textarea name="discipline_control" placeholder="Кто нарушил / кто не сдал"></textarea>

    <label id="lblClientIssues">Müştəri problemləri:</label>
    <textarea name="client_issues" placeholder="Проблемы клиентов и решения"></textarea>

    <label id="lblFinancial">Maliyyə nəzarəti:</label>
    <textarea name="financial_control" placeholder="Входящие / исходящие"></textarea>

    <label id="lblDecisions">Decision Log:</label>
    <textarea name="decisions" placeholder="Принятые решения сегодня"></textarea>

    <label id="lblTomorrow">Sabah üçün plan:</label>
    <textarea name="tomorrow_plan" placeholder="План на завтра"></textarea>

    <button type="submit" class="save" id="btnSave">Saxla</button>
  </form>

  <p id="status"></p>
</div>

<script>
const TEXT_AZ = {
  title:"Direktor — gündəlik hesabat",date:"Tarix:",name:"Ad:",
  reportAnalysis:"İşçi hesabatlarının analizi:",
  crmWork:"CRM işi:",tasksStatus:"Bitrix24 tapşırıqları:",
  discipline:"İntizam nəzarəti:",clientIssues:"Müştəri problemləri:",
  financial:"Maliyyə nəzarəti:",decisions:"Decision Log:",
  tomorrow:"Sabah üçün plan:",save:"Saxla"
};
const TEXT_RU = {
  title:"Директор — ежедневный отчёт",date:"Дата:",name:"Имя:",
  reportAnalysis:"Анализ отчётов сотрудников:",
  crmWork:"Работа в CRM:",tasksStatus:"Задачи Bitrix24:",
  discipline:"Контроль дисциплины:",clientIssues:"Клиентские проблемы:",
  financial:"Финансовый контроль:",decisions:"Decision Log:",
  tomorrow:"План на завтра:",save:"Сохранить"
};
function switchLang(lang){
  const t = lang==="AZ"?TEXT_AZ:TEXT_RU;
  formTitle.textContent=t.title; lblDate.textContent=t.date; lblName.textContent=t.name;
  lblReportAnalysis.textContent=t.reportAnalysis; lblCRMWork.textContent=t.crmWork;
  lblTasksStatus.textContent=t.tasksStatus; lblDiscipline.textContent=t.discipline;
  lblClientIssues.textContent=t.clientIssues; lblFinancial.textContent=t.financial;
  lblDecisions.textContent=t.decisions; lblTomorrow.textContent=t.tomorrow;
  btnSave.textContent=t.save; langInp.value=lang;
  btnAZ.classList.toggle("active",lang==="AZ"); btnRU.classList.toggle("active",lang==="RU");
}
const formTitle=document.getElementById("formTitle"), lblDate=document.getElementById("lblDate"),
lblName=document.getElementById("lblName"), lblReportAnalysis=document.getElementById("lblReportAnalysis"),
lblCRMWork=document.getElementById("lblCRMWork"), lblTasksStatus=document.getElementById("lblTasksStatus"),
lblDiscipline=document.getElementById("lblDiscipline"), lblClientIssues=document.getElementById("lblClientIssues"),
lblFinancial=document.getElementById("lblFinancial"), lblDecisions=document.getElementById("lblDecisions"),
lblTomorrow=document.getElementById("lblTomorrow"), btnSave=document.getElementById("btnSave"),
btnAZ=document.getElementById("btnAZ"), btnRU=document.getElementById("btnRU"),
langInp=document.getElementById("lang");

btnAZ.onclick=()=>switchLang("AZ");
btnRU.onclick=()=>switchLang("RU");

// ✅ Отправка в ТВОЙ новый Web App
document.getElementById("directorForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const status=document.getElementById("status");
  const data=Object.fromEntries(new FormData(this).entries());
  try{
    await fetch("https://script.google.com/macros/s/AKfycbwJtKQaJ-QnbeH0SpK4Bh6c_ZN-qOUD5Jt1ShRKKhD-UYmLFJJumW10Ilpqjm4lmBSF/exec",{
      method:"POST",
      mode:"no-cors",
      body:JSON.stringify(data)
    });
    status.textContent="✔ Yadda saxlanıldı / Сохранено";
    status.className="success";
    this.reset();
  }catch(err){
    status.textContent="❌ Xəta / Ошибка";
    status.className="error";
  }
});
</script>
</body>
</html>
