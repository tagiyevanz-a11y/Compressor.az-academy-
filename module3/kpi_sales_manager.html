<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>KPI ‚Äî Satƒ±≈ü Meneceri / –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; background: #f0f4f9;
      font-family: system-ui, sans-serif; color: #0f172a;
    }
    #kpi-wrap {
      max-width: 1100px; margin: 20px auto; padding: 22px;
      background: #fff; border-radius: 18px;
      border: 1px solid #d9e3f2; box-shadow: 0 6px 20px rgba(0,82,165,0.12);
    }
    .kpi-header {
      display: flex; justify-content: space-between; align-items: center;
      flex-wrap: wrap; gap: 14px; margin-bottom: 20px;
    }
    .kpi-role {
      font-size: 22px; font-weight: 700; color: #003a78;
    }
    .kpi-role-sub {
      font-size: 13px; color: #6b7280;
    }
    .btn-primary {
      background: #0052a5; color: white; border: none;
      border-radius: 999px; padding: 10px 18px; font-size: 12px;
      font-weight: 600; cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,82,165,0.25);
    }
    .btn-primary:hover { background: #004488; transform: translateY(-1px); }

    .charts-row {
      display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 20px;
    }
    @media (max-width: 900px) { .charts-row { grid-template-columns: 1fr; } }

    .chart-card {
      padding: 14px; border-radius: 14px;
      background: #f6f9ff; border: 1px solid #d8e4f7;
    }
    .chart-title { font-size: 13px; font-weight: 600; color: #003a78; margin-bottom: 4px; }
    .chart-sub { font-size: 11px; color: #6b7280; margin-bottom: 8px; }

    table {
      width: 100%; border-collapse: collapse;
      background: #ffffff; font-size: 12px;
      border-radius: 14px; overflow: hidden;
      border: 1px solid #dce4ef;
    }
    thead { background: #d8eaff; }
    th, td { padding: 7px 8px; border-bottom: 1px solid #e5e7eb; }
    th { color: #003a78; font-weight: 600; font-size: 11px; }

    td input {
      width: 100%; padding: 5px; border-radius: 8px;
      border: 1px solid #cdd6e8; background: #f0f4fa;
    }
    td input:focus { border-color: #0052a5; background: #fff; }

    .kpi-name { font-weight: 600; color: #002f63; }

    .kpi-result { text-align: center; font-weight: 700; font-size: 12px; }
    .good { color: #16a34a; }
    .neutral { color: #6b7280; }
    .bad { color: #dc2626; }

    .footer-note {
      text-align: right; font-size: 11px; color: #9ca3af; margin-top: 10px;
    }
  </style>
</head>

<body>
<div id="kpi-wrap">
  <header class="kpi-header">
    <div>
      <div class="kpi-role">Satƒ±≈ü Meneceri / –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</div>
      <div class="kpi-role-sub">KPI formu ‚Äì Plan / Fakt / Analitika</div>
    </div>

    <button class="btn-primary" onclick="exportToPDF()">üìÑ –°–∫–∞—á–∞—Ç—å PDF</button>
  </header>

  <!-- ==== –ì–†–ê–§–ò–ö–ò ==== -->
  <section class="charts-row">
    <div class="chart-card">
      <div class="chart-title">√úmumi KPI icrasƒ±</div>
      <div class="chart-sub">Orta % g√∂st…ôrici …ôsasƒ±nda dair…ôvi diaqram</div>
      <canvas id="kpiDonut"></canvas>
    </div>

    <div class="chart-card">
      <div class="chart-title">Plan vs Fakt (c…ômi)</div>
      <div class="chart-sub">Plan v…ô Fakt c…ômi √ºzr…ô m√ºqayis…ô</div>
      <canvas id="kpiBar"></canvas>
    </div>
  </section>

  <!-- ==== KPI –¢–ê–ë–õ–ò–¶–ê ==== -->
  <section>
    <table>
      <thead>
      <tr>
        <th>KPI</th>
        <th>Plan</th>
        <th>Fakt</th>
        <th>ƒ∞cra, %</th>
        <th>≈û…ôrh</th>
      </tr>
      </thead>

      <tbody>

      <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ -->
      <tr data-kpi-row>
        <td class="kpi-name">Satƒ±≈ü h…ôcmi (AZN)</td>
        <td><input class="kpi-plan" type="number"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">Satƒ±lan avadanlƒ±q sayƒ±</td>
        <td><input class="kpi-plan" type="number"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
      <tr data-kpi-row>
        <td class="kpi-name">G√ºnl√ºk z…ôngl…ôr (…ôd…ôd)</td>
        <td><input class="kpi-plan" type="number" placeholder="M…ôs: 30"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">H…ôft…ôlik g√∂r√º≈ül…ôr</td>
        <td><input class="kpi-plan" type="number" placeholder="M…ôs: 5"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">Aylƒ±q g√∂nd…ôril…ôn –ö–ü sayƒ±</td>
        <td><input class="kpi-plan" type="number" placeholder="40"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <!-- –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ -->
      <tr data-kpi-row>
        <td class="kpi-name">Konversiya: lead ‚Üí —Å–¥–µ–ª–∫–∞ (%)</td>
        <td><input class="kpi-plan" type="number" placeholder="M…ôs: 30%"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">Konversiya: —Å–¥–µ–ª–∫–∞ ‚Üí g√∂r√º≈ü (%)</td>
        <td><input class="kpi-plan" type="number" placeholder="M…ôs: 60%"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">Konversiya: baƒülanan —Å–¥–µ–ªkalar (WON, %)</td>
        <td><input class="kpi-plan" type="number" placeholder="25%"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">Lead-…ô reaksiya vaxtƒ± (d…ôq)</td>
        <td><input class="kpi-plan" type="number" placeholder="10 d…ôq"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      <tr data-kpi-row>
        <td class="kpi-name">CRM doldurma d…ôqiqliyi (%)</td>
        <td><input class="kpi-plan" type="number" placeholder="100"></td>
        <td><input class="kpi-fact" type="number"></td>
        <td class="kpi-result">‚Äì</td>
        <td><input type="text"></td>
      </tr>

      </tbody>
    </table>
  </section>

  <div class="footer-note">
    Formanƒ± doldurduqdan sonra PDF kimi y√ºkl…ôy…ô bil…ôrsiniz.
  </div>
</div>

<script>
  let donutChart, barChart;

  function initCharts() {
    donutChart = new Chart(document.getElementById('kpiDonut'), {
      type: 'doughnut',
      data: {
        labels: ['ƒ∞cra olunub', 'Qalƒ±q'],
        datasets: [{
          data: [0, 100],
          backgroundColor: ['#0052a5', '#dbe8f8']
        }]
      },
      options: {
        cutout: '65%',
        plugins: { legend: { position: 'bottom' } }
      }
    });

    barChart = new Chart(document.getElementById('kpiBar'), {
      type: 'bar',
      data: {
        labels: ['Plan', 'Fakt'],
        datasets: [{
          backgroundColor: ['#60a5fa', '#0052a5'],
          data: [0, 0]
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: false } }
      }
    });
  }

  function recalcKPI() {
    const rows = document.querySelectorAll('[data-kpi-row]');
    let totalPlan = 0, totalFact = 0;
    let sumPercent = 0, countPercent = 0;

    rows.forEach(row => {
      const plan = parseFloat(row.querySelector('.kpi-plan').value) || 0;
      const fact = parseFloat(row.queryquerySelector('.kpi-fact').value) || 0;
      const cell = row.querySelector('.kpi-result');

      let percent = '‚Äì';
      cell.className = 'kpi-result neutral';

      if (plan > 0) {
        const p = (fact / plan) * 100;
        const r = Math.round(p);
        percent = r + '%';

        sumPercent += p;
        countPercent++;

        if (p >= 100) cell.classList.add('good');
        else if (p >= 80) cell.classList.add('neutral');
        else cell.classList.add('bad');
      }

      cell.textContent = percent;

      totalPlan += plan;
      totalFact += fact;
    });

    const avg = countPercent ? sumPercent / countPercent : 0;
    donutChart.data.datasets[0].data = [avg, Math.max(100-avg,0)];
    donutChart.update();

    barChart.data.datasets[0].data = [totalPlan, totalFact];
    barChart.update();
  }

  function exportToPDF() {
    html2pdf()
      .from(document.getElementById('kpi-wrap'))
      .set({
        margin: 10,
        filename: 'kpi_sales.pdf',
        html2canvas: { scale: 2 },
        jsPDF: { format: 'a4', unit: 'mm' }
      })
      .save();
  }

  document.addEventListener('DOMContentLoaded', () => {
    initCharts();
    document.querySelectorAll('.kpi-plan, .kpi-fact').forEach(input => {
      input.addEventListener('input', recalcKPI);
    });
  });
</script>

</body>
</html>
